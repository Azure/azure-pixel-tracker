 Use the [manual][1] or [automated][2] deployment guide to launch the Personalized Offers solution into your Azure subscription. 

The Pixel Tracker and Personalized Offers will be linked together using Azure Stream Analytics. Stream Analytics will be used to filter the Pixel Tracker Event Hub to only the events of intereste for the personalized offers solution. It will then output that data into the Event Hub deployed in the personalized offers resource group, where it will be consumed by that solution. 


### Create Raw Data Stream Job
This stream job will take the data generated by the PersonalizedOfferFunction and aggregate it to write to the productCollection and the userCollection in DocumentDb.

1. Log into the [Azure Management Portal](https://ms.portal.azure.com) 
2. Locate the resource group  you created for this project and click on it displaying the resources associated with the group in the resource group blade.
3. At the top of the Resource Group blade click __+Add__.
4. In the *Search Everything* search box enter **Stream Analytics job**
5. Choose **Stream Analytics job** from the results then click *Create*
6. Enter **pixel2personoffers** as the name and choose the subscription, resource group and location using previous choices.
7. Click *Create* and return to the *Resource groups* blade. 
Select the **pixel2personoffers** resource to open the Stream Analytics job to modify the job settings.
8. Click *Inputs* on the left to open the Inputs Blade  
    1. At the top of the *Inputs* page click __+ADD INPUT__
    2. In the new panel:
    	
    	a. *Input Alias* : **pixelData**
    	
    	b. *Source Type* : **Data stream**
    2. *Source* : **Event hub**
    3. *Subscription* : Use event hub from current subscription
    4. *Service bus namespace* : **[UI]pixeltracker[N]**
    5. *Event hub name* : **pixeltracker**
    6. *Event hub policy name* : **RootManageSharedAccessKey**
    7. *Event hub consumer group* : Create New, **pixel2po**
    8. *Event serialization format* : JSON
    9. *Encoding* : UTF-8
    10. Click __Create__
9. Click *Outputs* on the left to open the Outputs Blade
    1. Click __Add__ at the top
    2. In the new panel:
    
    	a. *Output Alias* : **clickstreamdl**
    	
    	b. *Sink* : **Data Lake Store**
    	
		c. At this point you have to click **Authorize Connection**
    	    	
    	d. *Subscription* : This should be the subscription that the Data Lake you created earlier is in (same as your resource group)
    	
    	e. *Account Name : **unique string**
		
		f. *Path prefix pattern*: **personalizedoffers/clickstream/{date}**
		
		g. Click __Create__
	3. Click __Add__ at the top
    4. In the new panel:
    
    	a. *Output Alias* : **offersdl**
    	
    	b. *Sink* : **Data Lake Store**
    	
		c. At this point you have to click **Authorize Connection**
    	    	
    	d. *Subscription* : This should be the subscription that the Data Lake you created earlier is in (same as your resource group)
    	
    	e. *Account Name : **unique string**
		
		f. *Path prefix pattern*: **personalizedoffers/offers/{date}**
		
		g. Click __Create__

10. Click *Query* on the left to open the Query Blade
    1. Copy the contents of the **RawDataQuery.txt** file from the **src** directory
    2. Paste it into the query area replacing the current contents
    3. Click *Save*
    
11. Click *Overview* on the left

12. Click *Start* at the top to begin the stream job


[1]: https://github.com/Azure/cortana-intelligence-personalized-offers/tree/master/Manual%20Deployment%20Guide
[2]: https://github.com/Azure/cortana-intelligence-personalized-offers/tree/master/Automated%20Deployment%20Guide
